generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  USER
}

enum ScheduleStatus {
  DRAFTED
  PUBLISHED
}

model User {
  id            Int             @id @default(autoincrement())
  clerkId       String          @unique  // ‚Üê Clerk user ID for syncing
  
  // Basic info
  email         String          @unique
  name          String?
  firstName     String?
  lastName      String?
  imageUrl      String?
  
  // Account settings
  role          Role            @default(USER)
  subscription  Boolean         @default(false)
  
  // Metadata from Clerk
  publicMetadata    Json        @default("{}")
  privateMetadata   Json        @default("{}")
  
  // Timestamps
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  lastSyncedAt  DateTime        @default(now())  // ‚Üê Track last sync from Clerk
  isDeleted     Boolean  @default(false)

  // Relations
  schedules     ScheduleEntry[]
  
  @@index([clerkId])
  @@index([email])
  @@index([createdAt])
}

model ScheduleBatch {
  id         Int             @id @default(autoincrement())
  status     ScheduleStatus  @default(DRAFTED)

  startDate  DateTime
  endDate    DateTime
  totalDays  Int

  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt

  entries    ScheduleEntry[]

  @@index([status])
  @@index([startDate, endDate])
}


model ScheduleEntry {
  id         Int        @id @default(autoincrement())

  date       DateTime   // specific day
  startTime  String
  endTime    String
  totalHours Int

  userId     Int
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  batchId    Int
  batch      ScheduleBatch @relation(fields: [batchId], references: [id], onDelete: Cascade)

  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  @@unique([date, userId]) // üî• prevent duplicate date+user
  @@index([date])
  @@index([userId])
  @@index([batchId])
}
