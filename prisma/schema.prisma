generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  USER
  PENDING 
}

enum ScheduleStatus {
  DRAFTED
  PUBLISHED
}

model User {
  id            Int      @id @default(autoincrement())
  clerkId       String   @unique
  
  email         String?  @unique
  name          String?
  firstName     String?
  lastName      String?
  imageUrl      String?
  
  role          Role     @default(USER)
  subscription  Boolean  @default(false)

  publicMetadata  Json   @default("{}")
  privateMetadata Json   @default("{}")

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  lastSyncedAt  DateTime @default(now())

  isDeleted     Boolean  @default(false)
  deletedAt     DateTime?

  schedules     ScheduleEntry[]

  @@index([clerkId])
  @@index([email])
  @@index([createdAt])
}


model ScheduleBatch {
  id         Int             @id @default(autoincrement())
  status     ScheduleStatus  @default(DRAFTED)

  startDate  DateTime        // First day of the batch
  endDate    DateTime        // Last day of the batch
  totalDays  Int             // Total number of days in range

  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt

  entries    ScheduleEntry[]

  @@index([status])
  @@index([startDate, endDate])
}

model ScheduleEntry {
  id         Int        @id @default(autoincrement())

  date       DateTime   // specific day
  startTime  String     // "10:00"
  endTime    String     // "14:00"
  totalHours Float      // calculated hours

  userId     Int
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  batchId    Int
  batch      ScheduleBatch @relation(fields: [batchId], references: [id], onDelete: Cascade)

  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  @@unique([date, userId])
  @@index([date])
  @@index([userId])
  @@index([batchId])
}